openapi: '3.0.3'

info:
  version: 2.0.0
  title: Coin Wallet API V2

servers:
  - url: /api/v2

paths:
  /register:
    post:
      x-eov-operation-id: register
      x-eov-operation-handler: handlers
      description: Register new device
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              type: 'object'
              properties:
                walletId:
                  description: Wallet ID
                  $ref: '#/components/schemas/Hex64String'
                deviceId:
                  description: Device ID
                  $ref: '#/components/schemas/Hex64String'
                pinHash:
                  description: PIN Hash
                  $ref: '#/components/schemas/Hex64String'
              required:
                - walletId
                - deviceId
                - pinHash
      responses:
        '201':
          description: Registration Success
          content:
            'application/json':
              schema:
                allOf:
                  - $ref: '#/components/schemas/PublicToken'
                  - $ref: '#/components/schemas/PrivateToken'
        default:
          $ref: '#/components/responses/GeneralError'
  /token/public/pin:
    post:
      x-eov-operation-id: tokenPublicPinVerify
      x-eov-operation-handler: handlers
      description: Get public token
      parameters:
        - $ref: '#/components/parameters/deviceId'
      requestBody:
        $ref: '#/components/requestBodies/PIN'
      responses:
        '200':
          description: Public Token
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/PublicToken'
        default:
          $ref: '#/components/responses/GeneralError'
  /token/public/platform:
    get:
      x-eov-operation-id: tokenPublicPlatformOptions
      x-eov-operation-handler: handlers
      description: Get Assertion Options
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          $ref: '#/components/responses/AssertionOptionsResponse'
        default:
          $ref: '#/components/responses/GeneralError'
    post:
      x-eov-operation-id: tokenPublicPlatformVerify
      x-eov-operation-handler: handlers
      description: Verify Assertion
      parameters:
        - $ref: '#/components/parameters/deviceId'
      requestBody:
        $ref: '#/components/requestBodies/Assertion'
      responses:
        '200':
          $ref: '#/components/responses/AssertionResponse'
        default:
          $ref: '#/components/responses/GeneralError'
  /token/private:
    get:
      x-eov-operation-id: tokenPrivate
      x-eov-operation-handler: handlers
      description: Get Private Token
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          description: Private Token
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/PrivateToken'
        default:
          $ref: '#/components/responses/GeneralError'
  /token/private/pin:
    post:
      x-eov-operation-id: tokenPrivatePinVerify
      x-eov-operation-handler: handlers
      description: Get public token
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      requestBody:
        $ref: '#/components/requestBodies/PIN'
      responses:
        '200':
          description: Auth Result
          content:
            'application/json':
              schema:
                oneOf:
                  - $ref: '#/components/schemas/PrivateToken'
                  - $ref: '#/components/schemas/AssertionOptions'
        default:
          $ref: '#/components/responses/GeneralError'
  /token/private/platform:
    get:
      x-eov-operation-id: tokenPrivatePlatformOptions
      x-eov-operation-handler: handlers
      description: Get Assertion Options
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          $ref: '#/components/responses/AssertionOptionsResponse'
        default:
          $ref: '#/components/responses/GeneralError'
    post:
      x-eov-operation-id: tokenPrivatePlatformVerify
      x-eov-operation-handler: handlers
      description: Verify Assertion
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      requestBody:
        $ref: '#/components/requestBodies/Assertion'
      responses:
        '200':
          description: Auth Result
          content:
            'application/json':
              schema:
                oneOf:
                  - $ref: '#/components/schemas/PrivateToken'
                  - $ref: '#/components/schemas/AssertionOptions'
        default:
          $ref: '#/components/responses/GeneralError'
  /token/private/crossplatform:
    get:
      x-eov-operation-id: tokenPrivateCrossplatformOptions
      x-eov-operation-handler: handlers
      description: Get Assertion Options
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          $ref: '#/components/responses/AssertionOptionsResponse'
        default:
          $ref: '#/components/responses/GeneralError'
    post:
      x-eov-operation-id: tokenPrivateCrossplatformVerify
      x-eov-operation-handler: handlers
      description: Verify Assertion
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      requestBody:
        $ref: '#/components/requestBodies/Assertion'
      responses:
        '200':
          description: Private Token
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/PrivateToken'
        default:
          $ref: '#/components/responses/GeneralError'
  /platform/attestation:
    get:
      x-eov-operation-id: platformAttestationOptions
      x-eov-operation-handler: handlers
      description: Get Attestation Options for Platform Authenticator
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          $ref: '#/components/responses/AttestationOptionsResponse'
        default:
          $ref: '#/components/responses/GeneralError'
    post:
      x-eov-operation-id: platformAttestationVerify
      x-eov-operation-handler: handlers
      description: Verify Attestation for Platform Authenticator
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      requestBody:
        $ref: '#/components/requestBodies/Attestation'
      responses:
        '200':
          $ref: '#/components/responses/AttestationResponse'
        default:
          $ref: '#/components/responses/GeneralError'
  /crossplatform/attestation:
    get:
      x-eov-operation-id: crossplatformAttestationOptions
      x-eov-operation-handler: handlers
      description: Get Attestation Options for Cross-Platform Authenticator
      security:
        - walletSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          $ref: '#/components/responses/AttestationOptionsResponse'
        default:
          $ref: '#/components/responses/GeneralError'
    post:
      x-eov-operation-id: crossplatformAttestationVerify
      x-eov-operation-handler: handlers
      description: Verify Attestation for Cross-Platform Authenticator
      security:
        - walletSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      requestBody:
        $ref: '#/components/requestBodies/Attestation'
      responses:
        '200':
          $ref: '#/components/responses/AttestationResponse'
        default:
          $ref: '#/components/responses/GeneralError'
  /crossplatform:
    get:
      x-eov-operation-id: listCrossplatformAuthenticators
      x-eov-operation-handler: handlers
      description: List Cross-Platform Authenticators
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          description: List of Authenticators
          content:
            'application/json':
              schema:
                type: array
        default:
          $ref: '#/components/responses/GeneralError'
    delete:
      x-eov-operation-id: removeCrossplatformAuthenticator
      x-eov-operation-handler: handlers
      description: Remove Authenticator
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - walletSignature: []
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              type: 'object'
              properties:
                credentialID:
                  type: string
              required:
                - credentialID
      responses:
        '200':
          $ref: '#/components/responses/SuccessResponse'
        default:
          $ref: '#/components/responses/GeneralError'
  /settings:
    get:
      x-eov-operation-id: getSettings
      x-eov-operation-handler: handlers
      description: Get user Settings
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: User Settings
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/Settings'
        default:
          $ref: '#/components/responses/GeneralError'
    patch:
      x-eov-operation-id: setSettings
      x-eov-operation-handler: handlers
      description: Update user Settings
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - walletSignature: []
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/Settings'
      responses:
        '200':
          description: Update user Settings result
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/Settings'
        default:
          $ref: '#/components/responses/GeneralError'
  /details:
    get:
      x-eov-operation-id: getDetails
      x-eov-operation-handler: handlers
      description: Get user details
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: User datails
          content:
            'application/json':
              schema:
                type: object
                properties:
                  data:
                    description: User details
                    type: string
                required:
                  - data
        default:
          $ref: '#/components/responses/GeneralError'
    put:
      x-eov-operation-id: setDetails
      x-eov-operation-handler: handlers
      description: Update user details
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              type: 'object'
              properties:
                data:
                  description: User details
                  type: string
              required:
                - data
      responses:
        '200':
          description: Update user details result
          content:
            'application/json':
              schema:
                type: object
                properties:
                  data:
                    type: string
                required:
                  - data
        default:
          $ref: '#/components/responses/GeneralError'
  /username:
    put:
      x-eov-operation-id: setUsername
      x-eov-operation-handler: handlers
      description: Update username
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/Username'
      responses:
        '200':
          description: Update username result
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/Username'
        default:
          $ref: '#/components/responses/GeneralError'
  /device:
    delete:
      x-eov-operation-id: removeDevice
      x-eov-operation-handler: handlers
      description: Remove Device
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      responses:
        '200':
          $ref: '#/components/responses/SuccessResponse'
        default:
          $ref: '#/components/responses/GeneralError'
  /wallet:
    delete:
      x-eov-operation-id: removeWallet
      x-eov-operation-handler: handlers
      description: Remove Wallet
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - walletSignature: []
      responses:
        '200':
          $ref: '#/components/responses/SuccessResponse'
        default:
          $ref: '#/components/responses/GeneralError'

components:
  schemas:
    Hex64String:
      type: string
      pattern: "^[a-f0-9]{64}$"
    Hex128String:
      type: string
      pattern: "^[a-f0-9]{128}$"
    PublicToken:
      type: object
      properties:
        publicToken:
          $ref: '#/components/schemas/Hex128String'
      required:
        - publicToken
    PrivateToken:
      type: object
      properties:
        privateToken:
          $ref: '#/components/schemas/Hex128String'
      required:
        - privateToken
    AttestationOptions:
      type: object
      properties:
        challenge:
          type: string
      required:
        - challenge
    AssertionOptions:
      type: object
      properties:
        challenge:
          type: string
      required:
        - challenge
    Username:
      type: object
      properties:
        username:
          type: string
      required:
        - username
    Settings:
      type: object
      properties:
        1faPrivate:
          description: Authorization for private token
          type: boolean
  parameters:
    deviceId:
      in: query
      name: id
      description: Device ID
      schema:
        $ref: '#/components/schemas/Hex64String'
  requestBodies:
    PIN:
      description: PIN Hash
      required: true
      content:
        'application/json':
          schema:
            type: 'object'
            properties:
              pinHash:
                description: PIN Hash
                $ref: '#/components/schemas/Hex64String'
            required:
              - pinHash
    Attestation:
      description: Attestation Request
      required: true
      content:
        'application/json':
          schema:
            type: 'object'
    Assertion:
      description: Assertion Request
      required: true
      content:
        'application/json':
          schema:
            type: 'object'
  responses:
    AttestationOptionsResponse:
      description: Attestation Options
      content:
        'application/json':
          schema:
            $ref: '#/components/schemas/AttestationOptions'
    AssertionOptionsResponse:
      description: Assertion Options
      content:
        'application/json':
          schema:
            $ref: '#/components/schemas/AssertionOptions'
    AttestationResponse:
      description: Success Attestation Result
      content:
        'application/json':
          schema:
            type: object
            properties:
              success:
                type: boolean
            required:
              - success
    AssertionResponse:
      description: Success Assertion Result
      content:
        'application/json':
          schema:
            type: object
    SuccessResponse:
      description: Success Response
      content:
        'application/json':
          schema:
            type: object
            properties:
              success:
                type: boolean
            required:
              - success
    GeneralError:
      description: Unexpected error
      content:
        'application/json':
          schema:
            required:
              - code
              - message
            properties:
              code:
                type: integer
                format: int32
              message:
                type: string
  securitySchemes:
    deviceSignature:
      type: apiKey
      in: header
      name: Signature
    walletSignature:
      type: apiKey
      in: header
      name: Signature
