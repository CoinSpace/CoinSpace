openapi: '3.0.3'

info:
  version: 3.0.0
  title: Coin Wallet API V3

servers:
  - url: /api/v3

paths:
  /cryptos:
    get:
      x-eov-operation-id: getCryptos
      x-eov-operation-handler: handlers
      description: Get all cryptos
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: List of cryptos
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/CryptoList'
        default:
          $ref: '#/components/responses/GeneralError'
  /ticker:
    get:
      x-eov-operation-id: getTicker
      x-eov-operation-handler: handlers
      description: Get prices of single crypto
      parameters:
        - $ref: '#/components/parameters/deviceId'
        - $ref: '#/components/parameters/cryptoId'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: Ticker for crypro
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/Ticker'
        default:
          $ref: '#/components/responses/GeneralError'
  /tickers:
    get:
      x-eov-operation-id: getTickers
      x-eov-operation-handler: handlers
      description: Get prices of one or more crypto
      parameters:
        - $ref: '#/components/parameters/deviceId'
        - $ref: '#/components/parameters/cryptoIds'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: List of tickers for crypto
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/TickerList'
        default:
          $ref: '#/components/responses/GeneralError'
  /fees:
    get:
      x-eov-operation-id: getFees
      x-eov-operation-handler: handlers
      description: Get transaction fees for coin
      parameters:
        - $ref: '#/components/parameters/deviceId'
        - $ref: '#/components/parameters/cryptoId'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: Fees for coin
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/FeeList'
        default:
          $ref: '#/components/responses/GeneralError'
  /csfee:
    get:
      x-eov-operation-id: getCsFee
      x-eov-operation-handler: handlers
      description: Get transaction cs fees for coin
      parameters:
        - $ref: '#/components/parameters/deviceId'
        - $ref: '#/components/parameters/cryptoId'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: Fees for coin
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/CsFee'
        default:
          $ref: '#/components/responses/GeneralError'
  /mecto:
    get:
      x-eov-operation-id: searchMecto
      x-eov-operation-handler: handlers
      description: Find nearby mecto users
      parameters:
        - $ref: '#/components/parameters/deviceId'
        - $ref: '#/components/parameters/lat'
        - $ref: '#/components/parameters/lon'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: Nearby mecto users
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/MectoUsers'
        default:
          $ref: '#/components/responses/GeneralError'
    put:
      x-eov-operation-id: saveMecto
      x-eov-operation-handler: handlers
      description: Save mecto
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/Mecto'
      responses:
        '200':
          $ref: '#/components/responses/SuccessResponse'
        default:
          $ref: '#/components/responses/GeneralError'
    delete:
      x-eov-operation-id: removeMecto
      x-eov-operation-handler: handlers
      description: Remove mecto
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      responses:
        '200':
          $ref: '#/components/responses/SuccessResponse'
        default:
          $ref: '#/components/responses/GeneralError'
  /storage/{storageName}:
    get:
      x-eov-operation-id: getStorage
      x-eov-operation-handler: handlers
      description: Get storage
      parameters:
        - $ref: '#/components/parameters/deviceId'
        - $ref: '#/components/parameters/storageName'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: Storage
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/Storage'
        default:
          $ref: '#/components/responses/GeneralError'
    put:
      x-eov-operation-id: setStorage
      x-eov-operation-handler: handlers
      description: Update storage
      parameters:
        - $ref: '#/components/parameters/deviceId'
        - $ref: '#/components/parameters/storageName'
      security:
        - deviceSignature: []
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/Storage'
      responses:
        '200':
          description: Update storage result
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/Storage'
        default:
          $ref: '#/components/responses/GeneralError'

components:
  schemas:
    Hex64String:
      type: string
      pattern: "^[a-f0-9]{64}$"
    CryptoId:
      type: string
      pattern: '^.+@.+$'
    CryptoIdList:
      type: array
      items:
        $ref: '#/components/schemas/CryptoId'
    CryptoList:
      type: array
      items:
        type: object
        properties:
          _id:
            $ref: '#/components/schemas/CryptoId'
          platform:
            type: string
          symbol:
            type: string
          name:
            type: string
          decimals:
            type: number
            nullable: true
          logo:
            type: string
        required:
          - _id
          - platform
          - symbol
          - name
          - decimals
          - logo
    Ticker:
      type: object
      properties:
        _id:
          type: string
        prices:
          type: object
      required:
        - _id
        - prices
    TickerList:
      type: array
      items:
        $ref: '#/components/schemas/Ticker'
    Fee:
      type: object
      properties:
        name:
          type: string
        value:
          type: number
      required:
        - name
        - value
    FeeList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Fee'
      required:
        - items
    CsFee:
      type: object
      properties:
        fee:
          type: number
        minFee:
          type: number
        maxFee:
          type: number
        rbfFee:
          type: number
        addresses:
          type: array
          items:
            type: string
        whitelist:
          type: array
          items:
            type: string
      required:
        - fee
        - minFee
        - maxFee
        - rbfFee
        - addresses
        - whitelist
    Mecto:
      type: object
      properties:
        username:
          type: string
        email:
          type: string
        avatarIndex:
          type: integer
        address:
          type: string
        lat:
          type: number
        lon:
          type: number
      required:
        - username
        - email
        - avatarIndex
        - address
        - lat
        - lon
    MectoUsers:
      type: array
      items:
        type: object
        properties:
          username:
            type: string
          email:
            type: string
          avatarIndex:
            type: integer
          address:
            type: string
        required:
          - username
          - email
          - avatarIndex
          - address
    Storage:
      type: object
      properties:
        data:
          description: Storage
          type: string
          nullable: true
      required:
        - data
  parameters:
    deviceId:
      in: query
      name: id
      required: true
      description: Device ID
      schema:
        $ref: '#/components/schemas/Hex64String'
    cryptoId:
      in: query
      name: crypto
      required: true
      description: Crypto ID
      allowReserved: true
      schema:
        $ref: '#/components/schemas/CryptoId'
    cryptoIds:
      in: query
      name: crypto
      required: true
      description: List of Crypto IDs
      style: form
      explode: false
      allowReserved: true
      schema:
        $ref: '#/components/schemas/CryptoIdList'
    lat:
      in: query
      name: lat
      required: true
      description: Latitude
      schema:
        type: number
    lon:
      in: query
      name: lon
      required: true
      description: Longitude
      schema:
        type: number
    storageName:
      in: path
      name: storageName
      schema:
        type: string
      required: true
      description: Storage name
  responses:
    SuccessResponse:
      description: Success Response
      content:
        'application/json':
          schema:
            type: object
            properties:
              success:
                type: boolean
            required:
              - success
    GeneralError:
      description: Unexpected error
      content:
        'application/json':
          schema:
            required:
              - code
              - error
            properties:
              code:
                type: integer
                format: int32
              error:
                type: string
  securitySchemes:
    deviceSignature:
      type: apiKey
      in: header
      name: Signature
