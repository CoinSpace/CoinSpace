openapi: 3.0.3

info:
  version: 4.0.0
  title: Coin Wallet API V4

servers:
  - url: https://coin.space/api/v4

paths:
  /crossplatform:
    get:
      x-eov-operation-id: listCrossplatformAuthenticators
      x-eov-operation-handler: handlers
      description: List cross-platform authenticators
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          description: List of authenticators
          content:
            application/json:
              schema:
                type: array
                maxItems: 10
                items:
                  type: object
                  additionalProperties: false
                  properties:
                    credentialID:
                      $ref: '#/components/schemas/Base64UrlString'
                    date:
                      $ref: '#/components/schemas/ISODateString'
                  required:
                    - credentialID
                    - date
        default:
          $ref: '#/components/responses/GeneralError'
    delete:
      x-eov-operation-id: removeCrossplatformAuthenticator
      x-eov-operation-handler: handlers
      description: Remove authenticator
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - walletSignature: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              properties:
                credentialID:
                  $ref: '#/components/schemas/Base64UrlString'
              required:
                - credentialID
      responses:
        '200':
          $ref: '#/components/responses/SuccessResponse'
        default:
          $ref: '#/components/responses/GeneralError'
  /crossplatform/registration:
    get:
      x-eov-operation-id: crossplatformRegistrationOptions
      x-eov-operation-handler: handlers
      description: Get registration options for cross-platform authenticator
      security:
        - walletSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          $ref: '#/components/responses/RegistrationOptionsResponse'
        default:
          $ref: '#/components/responses/GeneralError'
    post:
      x-eov-operation-id: crossplatformRegistrationVerify
      x-eov-operation-handler: handlers
      description: Verify registration for cross-platform authenticator
      security:
        - walletSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      requestBody:
        $ref: '#/components/requestBodies/Registration'
      responses:
        '200':
          $ref: '#/components/responses/RegistrationResponse'
        default:
          $ref: '#/components/responses/GeneralError'
  /cryptos:
    get:
      x-eov-operation-id: getCryptos
      x-eov-operation-handler: handlers
      description: Get all cryptos
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: List of cryptos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CryptoList'
        default:
          $ref: '#/components/responses/GeneralError'
  /csfee:
    get:
      x-eov-operation-id: getCsFee
      x-eov-operation-handler: handlers
      description: Get transaction cs fees for coin
      parameters:
        - $ref: '#/components/parameters/deviceId'
        - $ref: '#/components/parameters/cryptoId'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: Fees for coin
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CsFee'
        default:
          $ref: '#/components/responses/GeneralError'
  /csfee/addresses:
    get:
      x-eov-operation-id: getCsFeeAddresses
      x-eov-operation-handler: handlers
      description: Get all cs fees addresses for coin
      parameters:
        - $ref: '#/components/parameters/cryptoId'
      security:
        - apiKey: []
      responses:
        '200':
          description: Cs fees addresses
          content:
            application/json:
              schema:
                type: array
                maxItems: 128
                items:
                  $ref: '#/components/schemas/AnyCryptoAddress'
        default:
          $ref: '#/components/responses/GeneralError'
  /details:
    get:
      x-eov-operation-id: getDetails
      x-eov-operation-handler: handlers
      description: Get user details
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: User datails
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                properties:
                  data:
                    $ref: '#/components/schemas/Base64String'
                required:
                  - data
        default:
          $ref: '#/components/responses/GeneralError'
    put:
      x-eov-operation-id: setDetails
      x-eov-operation-handler: handlers
      description: Update user details
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              properties:
                data:
                  $ref: '#/components/schemas/Base64String'
              required:
                - data
      responses:
        '200':
          description: Update user details result
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                properties:
                  data:
                    $ref: '#/components/schemas/Base64String'
                required:
                  - data
        default:
          $ref: '#/components/responses/GeneralError'
  /platform:
    delete:
      x-eov-operation-id: removePlatformAuthenticator
      x-eov-operation-handler: handlers
      description: Remove authenticator
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - walletSignature: []
      responses:
        '200':
          $ref: '#/components/responses/SuccessResponse'
        default:
          $ref: '#/components/responses/GeneralError'
  /platform/registration:
    get:
      x-eov-operation-id: platformRegistrationOptions
      x-eov-operation-handler: handlers
      description: Get registration options for platform authenticator
      security:
        - walletSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          $ref: '#/components/responses/RegistrationOptionsResponse'
        default:
          $ref: '#/components/responses/GeneralError'
    post:
      x-eov-operation-id: platformRegistrationVerify
      x-eov-operation-handler: handlers
      description: Verify registration for platform authenticator
      security:
        - walletSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      requestBody:
        $ref: '#/components/requestBodies/Registration'
      responses:
        '200':
          $ref: '#/components/responses/RegistrationResponse'
        default:
          $ref: '#/components/responses/GeneralError'
  /register:
    post:
      x-eov-operation-id: register
      x-eov-operation-handler: handlers
      description: Register new device
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              properties:
                walletId:
                  $ref: '#/components/schemas/Hex64String'
                deviceId:
                  $ref: '#/components/schemas/Hex64String'
                pinHash:
                  $ref: '#/components/schemas/Hex64String'
              required:
                - walletId
                - deviceId
                - pinHash
      responses:
        '201':
          description: Registration success
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/DeviceToken'
                  - $ref: '#/components/schemas/WalletToken'
        default:
          $ref: '#/components/responses/GeneralError'
  /settings:
    get:
      x-eov-operation-id: getSettings
      x-eov-operation-handler: handlers
      description: Get user settings
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: User settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Settings'
        default:
          $ref: '#/components/responses/GeneralError'
    patch:
      x-eov-operation-id: setSettings
      x-eov-operation-handler: handlers
      description: Update user settings
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - walletSignature: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Settings'
      responses:
        '200':
          description: Update user settings result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Settings'
        default:
          $ref: '#/components/responses/GeneralError'
  /storage/{storageName}:
    get:
      x-eov-operation-id: getStorage
      x-eov-operation-handler: handlers
      description: Get storage
      parameters:
        - $ref: '#/components/parameters/deviceId'
        - $ref: '#/components/parameters/storageName'
      security:
        - deviceSignature: []
      responses:
        '200':
          description: Storage
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Storage'
        default:
          $ref: '#/components/responses/GeneralError'
    put:
      x-eov-operation-id: setStorage
      x-eov-operation-handler: handlers
      description: Update storage
      parameters:
        - $ref: '#/components/parameters/deviceId'
        - $ref: '#/components/parameters/storageName'
      security:
        - deviceSignature: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Storage'
      responses:
        '200':
          description: Update storage result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Storage'
        default:
          $ref: '#/components/responses/GeneralError'
  /token/device/pin:
    post:
      x-eov-operation-id: tokenDevicePinVerify
      x-eov-operation-handler: handlers
      description: Get device token
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security: []
      requestBody:
        $ref: '#/components/requestBodies/PIN'
      responses:
        '200':
          description: Device token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceToken'
        default:
          $ref: '#/components/responses/GeneralError'
  /token/device/platform:
    get:
      x-eov-operation-id: tokenDevicePlatformOptions
      x-eov-operation-handler: handlers
      description: Get authentication options
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security: []
      responses:
        '200':
          $ref: '#/components/responses/AuthenticationOptionsResponse'
        default:
          $ref: '#/components/responses/GeneralError'
    post:
      x-eov-operation-id: tokenDevicePlatformVerify
      x-eov-operation-handler: handlers
      description: Verify authentication
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security: []
      requestBody:
        $ref: '#/components/requestBodies/Authentication'
      responses:
        '200':
          $ref: '#/components/responses/AuthenticationResponse'
        default:
          $ref: '#/components/responses/GeneralError'
  /token/wallet:
    get:
      x-eov-operation-id: tokenWallet
      x-eov-operation-handler: handlers
      description: Get wallet token
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          description: Wallet token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletToken'
        default:
          $ref: '#/components/responses/GeneralError'
  /token/wallet/crossplatform:
    get:
      x-eov-operation-id: tokenWalletCrossplatformOptions
      x-eov-operation-handler: handlers
      description: Get authentication options
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      responses:
        '200':
          $ref: '#/components/responses/AuthenticationOptionsResponse'
        default:
          $ref: '#/components/responses/GeneralError'
    post:
      x-eov-operation-id: tokenWalletCrossplatformVerify
      x-eov-operation-handler: handlers
      description: Verify authentication
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      requestBody:
        $ref: '#/components/requestBodies/Authentication'
      responses:
        '200':
          description: Wallet token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletToken'
        default:
          $ref: '#/components/responses/GeneralError'
  /token/wallet/pin:
    post:
      x-eov-operation-id: tokenWalletPinVerify
      x-eov-operation-handler: handlers
      description: Get wallet token
      security:
        - deviceSignature: []
      parameters:
        - $ref: '#/components/parameters/deviceId'
      requestBody:
        $ref: '#/components/requestBodies/PIN'
      responses:
        '200':
          description: Auth Result
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/WalletToken'
                  - $ref: '#/components/schemas/AuthenticationOptions'
        default:
          $ref: '#/components/responses/GeneralError'
  /username:
    put:
      x-eov-operation-id: setUsername
      x-eov-operation-handler: handlers
      description: Update username
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - deviceSignature: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UsernameObject'
      responses:
        '200':
          description: Update username result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsernameObject'
        default:
          $ref: '#/components/responses/GeneralError'
  /wallet:
    delete:
      x-eov-operation-id: removeWallet
      x-eov-operation-handler: handlers
      description: Remove wallet
      parameters:
        - $ref: '#/components/parameters/deviceId'
      security:
        - walletSignature: []
      responses:
        '200':
          $ref: '#/components/responses/SuccessResponse'
        default:
          $ref: '#/components/responses/GeneralError'
components:
  schemas:
    AnyCryptoAddress:
      type: string
      pattern: ^.{1,256}$
      maxLength: 256
    AnyString256:
      type: string
      pattern: ^.{0,256}$
      maxLength: 256
    AuthenticationOptions:
      type: object
      properties:
        challenge:
          $ref: '#/components/schemas/Base64UrlString'
      required:
        - challenge
    AuthenticatorAuthenticationResponse:
      type: object
      additionalProperties: false
      properties:
        authenticatorData:
          $ref: '#/components/schemas/Base64UrlString'
        clientDataJSON:
          $ref: '#/components/schemas/Base64UrlString'
        signature:
          $ref: '#/components/schemas/Base64UrlString'
        userHandle:
          $ref: '#/components/schemas/Base64UrlString'
      required:
        - authenticatorData
        - clientDataJSON
        - signature
    Base64String:
      type: string
      pattern: ^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$
      maxLength: 2097152
      nullable: true
    Base64UrlString:
      type: string
      pattern: ^[A-Za-z0-9_-]*$
      maxLength: 2097152
      nullable: true
    CryptoId:
      type: string
      pattern: ^[a-z0-9-]+@[a-z0-9-]+$
      maxLength: 256
    CryptoIdStorage:
      type: string
      pattern: ^[A-Za-z0-9-]+@[a-z0-9-]+$
      maxLength: 256
    CryptoList:
      type: array
      maxItems: 10000
      items:
        type: object
        properties:
          _id:
            $ref: '#/components/schemas/CryptoId'
          platform:
            type: string
            pattern: ^[a-z-]+$
            maxLength: 256
          platformName:
            type: string
            pattern: ^[A-Za-z\s]+$
            maxLength: 256
          symbol:
            type: string
            pattern: ^[A-Z0-9]+$
            maxLength: 256
          name:
            $ref: '#/components/schemas/AnyString256'
          decimals:
            type: number
            format: int32
            minimum: 0
            maximum: 100
            nullable: true
          logo:
            type: string
            pattern: ^.+\.(svg|png|jpg)$
            maxLength: 256
        required:
          - _id
          - platform
          - symbol
          - name
          - decimals
          - logo
    CsFee:
      type: object
      additionalProperties: false
      properties:
        fee:
          type: number
          format: float
          minimum: 0
          maximum: 1
        minFee:
          type: number
        maxFee:
          type: number
        rbfFee:
          type: number
        address:
          $ref: '#/components/schemas/AnyCryptoAddress'
        feeAddition:
          type: number
      required:
        - fee
        - minFee
        - maxFee
        - address
    DeviceToken:
      type: object
      properties:
        deviceToken:
          $ref: '#/components/schemas/Hex128String'
      required:
        - deviceToken
    Hex128String:
      type: string
      pattern: ^[a-f0-9]{128}$
      maxLength: 128
    Hex64String:
      type: string
      pattern: ^[a-f0-9]{64}$
      maxLength: 64
    ISODateString:
      type: string
      pattern: ^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$
      maxLength: 24
    PublicKeyCredentialType:
      type: string
      pattern: ^public-key$
      maxLength: 10
    RegistrationOptions:
      type: object
      properties:
        challenge:
          $ref: '#/components/schemas/Base64UrlString'
      required:
        - challenge
    Settings:
      type: object
      additionalProperties: false
      properties:
        1faWallet:
          description: Authorization for wallet token
          type: boolean
        hasAuthenticators:
          description: Has cross-platform authenticators
          type: boolean
    Storage:
      type: object
      additionalProperties: false
      properties:
        data:
          $ref: '#/components/schemas/Base64String'
      required:
        - data
    Username:
      type: string
      pattern: ^[a-z0-9-]+$
      maxLength: 64
    UsernameObject:
      type: object
      additionalProperties: false
      properties:
        username:
          $ref: '#/components/schemas/Username'
      required:
        - username
    WalletToken:
      type: object
      properties:
        walletToken:
          $ref: '#/components/schemas/Hex128String'
      required:
        - walletToken
  requestBodies:
    Authentication:
      description: Authentication request
      required: true
      content:
        application/json:
          schema:
            type: object
            additionalProperties: false
            properties:
              id:
                $ref: '#/components/schemas/Base64UrlString'
              rawId:
                $ref: '#/components/schemas/Base64UrlString'
              response:
                $ref: '#/components/schemas/AuthenticatorAuthenticationResponse'
              type:
                $ref: '#/components/schemas/PublicKeyCredentialType'
              authenticatorAttachment:
                type: string
                maxLength: 32
              clientExtensionResults:
                type: object
            required:
              - id
              - rawId
              - response
              - type
              - authenticatorAttachment
              - clientExtensionResults
    PIN:
      description: PIN Hash
      required: true
      content:
        application/json:
          schema:
            type: object
            additionalProperties: false
            properties:
              pinHash:
                $ref: '#/components/schemas/Hex64String'
            required:
              - pinHash
    Registration:
      description: Registration request
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              id:
                $ref: '#/components/schemas/Base64UrlString'
            required:
              - id
  parameters:
    cryptoId:
      description: Crypto ID
      in: query
      name: crypto
      required: true
      allowReserved: true
      schema:
        $ref: '#/components/schemas/CryptoId'
    deviceId:
      description: Device ID
      in: query
      name: id
      required: true
      schema:
        $ref: '#/components/schemas/Hex64String'
    storageName:
      description: Storage name
      in: path
      name: storageName
      schema:
        $ref: '#/components/schemas/CryptoIdStorage'
      required: true
  responses:
    AuthenticationOptionsResponse:
      description: Authentication options
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AuthenticationOptions'
    AuthenticationResponse:
      description: Success authentication result
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DeviceToken'
    GeneralError:
      description: Unexpected error
      content:
        application/json:
          schema:
            type: object
            additionalProperties: false
            required:
              - code
              - error
            properties:
              code:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000
              error:
                type: string
                pattern: ^.{0,16384}$
                maxLength: 16384
    RegistrationOptionsResponse:
      description: Registration options
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/RegistrationOptions'
    RegistrationResponse:
      description: Success registration result
      content:
        application/json:
          schema:
            type: object
            additionalProperties: false
            properties:
              success:
                type: boolean
            required:
              - success
    SuccessResponse:
      description: Success response
      content:
        application/json:
          schema:
            type: object
            additionalProperties: false
            properties:
              success:
                type: boolean
            required:
              - success
  securitySchemes:
    apiKey:
      type: apiKey
      in: query
      name: apikey
    deviceSignature:
      type: apiKey
      in: header
      name: Signature
    walletSignature:
      type: apiKey
      in: header
      name: Signature
